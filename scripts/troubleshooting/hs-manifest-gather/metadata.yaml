file: script.sh
name: hs-manifest-gather
description: Hypershift manifests/CRs gather script
author: rbhilare
allowedGroups:
  - SREP
  - CEE
  - LPSRE
  - MCSTierTwo
labels:
  - key: OSD_TYPES
    description: Compatible cluster types for this script
    values:
      - Management
rbac:
  clusterRoleRules:
    - verbs:
        - "create"
      apiGroups:
        - ""
      resources:
        - "pods/exec"
    - verbs:
        - "create"
        - "get"
        - "list"
      apiGroups:
        - ""
      resources:
        - "pods"
    - verbs:
        - "list"
      apiGroups:
        - ""
      resources:
        - "services"
    - verbs:
        - "get"
        - "list"
      apiGroups:
        - "hypershift.openshift.io"
      resources:
        - "awsendpointservices"
        - "hostedclusters"
        - "nodepools"
        - "hostedcontrolplanes"
    - verbs:
        - "get"
        - "list"
      apiGroups:
        - ""
      resources:
        - "nodes"
    - verbs:
        - "get"
        - "list"
      apiGroups:
        - "infrastructure.cluster.x-k8s.io"
      resources:
        - "awsclusters"
        - "awsmachines"
        - "awsmachinetemplates"
        - "kubevirtclusters"
        - "kubevirtmachinetemplates"
        - "kubevirtmachines"
    - verbs:
        - "get"
        - "list"
      apiGroups:
        - "capi-provider.agent-install.openshift.io"
      resources:
        - "agentclusters"
        - "agentmachinetemplates"
        - "agentmachines"
    - verbs:
        - "get"
        - "list"
      apiGroups:
        - "cluster.x-k8s.io"
      resources:
        - "clusters"
        - "machinedeployments"
        - "machines"
        - "machinesets"
    - verbs:
        - "get"
        - "list"
      apiGroups:
        - ""
      resources:
        - "secrets"
    - verbs:
        - "get"
        - "list"
        - "create"
      apiGroups:
        - ""
      resources:
        - "pods/portforward"
    - verbs:
        - "get"
        - "list"
      apiGroups:
        - "config.openshift.io"
      resources:
        - "clusteroperators"
        - "clusterversions"
    - verbs:
        - "create"
        - "delete"
        - "get"
        - "list"
      apiGroups:
        - ""
      resources:
        - "namespaces"    
    - verbs:
        - "create"
        - "delete"
        - "list"
        - "get"
      apiGroups:
        - "rbac.authorization.k8s.io"
      resources:
        - "clusterrolebindings"
    - verbs:
        - "bind"
      apiGroups:
        - "rbac.authorization.k8s.io"
      resources:
        - "clusterroles"
      resourceNames:
        - "cluster-admin"
    - verbs:
        - "create"
        - "delete"
        - "get"
        - "list"
      apiGroups:
        - ""
      resources:
        - "serviceaccounts"
envs:
  - key: "CLUSTER_ID"
    description: "Hosted cluster internal ID"
    optional: false
language: bash
customerDataAccess: true
